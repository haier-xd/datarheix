<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Restreamer">
    <meta name="author" content="datarhei">
    <title>Restreamer</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
    <script src="./libs/scripts/clappr-0.3.3.min.js"></script>
    <script src="./libs/scripts/clappr-stats-0.1.4.min.js"></script>
    <script src="./libs/scripts/clappr-nerd-stats-0.1.0.min.js"></script>
    <style>
        .player-poster[data-poster] .poster-background[data-poster] {
            height: initial !important;
        }
    </style>
</head>
<body>
<div id="player" style="position:absolute;top:0;right:0;bottom:0;left:0"></div>
<script>
    function getQueryParam(value, defValue) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for(var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if(pair[0] == value) {
                return pair[1];
            }
        }
        return defValue;
    }

    var autoplay = getQueryParam("autoplay", false);
    if(autoplay === "1" || autoplay === "true" || autoplay === "yes" || autoplay === "on") {
        autoplay = true;
    }
    else {
        autoplay = false;
    }

    var mute = getQueryParam("mute", false);
    if(mute === "1" || mute === "true" || mute === "yes" || mute === "on") {
        mute = true;
    }
    else {
        mute = false;
    }

    var stats = getQueryParam("stats", false);
    if(stats === "1" || stats === "true" || stats === "yes" || stats === "on") {
        stats = true;
    }
    else {
        stats = false;
    }

    var plugins = [];

    if(stats == true) {
        plugins.push(ClapprNerdStats);
        plugins.push(ClapprStats);
    }

    var player = new window.Clappr.Player({
        source: 'hls/live.stream.m3u8',
        parentId: '#player',
        baseUrl: 'libs/scripts/',
        plugins: plugins,
        poster: 'images/live.jpg?t=' + String(new Date().getTime()),
        mediacontrol: {'seekbar': '#3daa48', 'buttons': '#3daa48'},
        height: '100%',
        width: '100%',
        disableCanAutoPlay: true,
        autoPlay: autoplay,
        mute: mute,
        clapprStats: {
            runEach: 1000,
            onReport: (metrics) => {},
        },
        clapprNerdStats: {
            shortcut: ['command+shift+s', 'ctrl+shift+s'],
            iconPosition: 'top-right'
        }
    });
    var posterPlugin = player.core.mediaControl.container.getPlugin('poster');
    player.on(window.Clappr.Events.PLAYER_STOP, function updatePoster () {
        posterPlugin.options.poster = 'images/live.jpg?t=' + String(new Date().getTime());
        posterPlugin.render();
    });
</script>
</body>
</html>
